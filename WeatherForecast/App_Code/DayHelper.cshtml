@using System.Globalization
@using WeatherForecast.Models

@helper NowHighlighting(int time) { 
    int now = DateTime.Now.Hour, timenow;
    if (now >= 3 && now < 9)
    {
        timenow = 1;
    }
    else
    if (now >= 9 && now < 15)
    {
        timenow = 2;
    }
    else
    if (now >= 15 && now < 21)
    {
        timenow = 3;
    }
    else
    {
        timenow = 4;
    }
    if (time == timenow)
    {
@:now
    }
}

@helper TemperatureDuringDay(Temp temp) {
    Dictionary<string, double> times = new Dictionary<string, double>()
    {
        { "Morning", temp.morn},
        { "Day", temp.day},
        { "Evening", temp.eve },
        { "Night", temp.night }
    };
    int i = 0;
    foreach (var time in times)
    {
        i++;
    <div class="time_of_day col-md-2 @NowHighlighting(i)">
        <div class="time_of_day_title">@time.Key</div>
        <p class="temperature">@Temperature(time.Value) °C</p>
    </div>
}
}

@helper Temperature(double temp) {
    if (temp > 0)
    {
        @:+@Math.Round(temp)
    }
    else
    {
        @:-@Math.Round(temp)
    }
}

@helper WindDirection(int deg) {
    string direction;
    if (deg >= 348.75 && deg < 33.75)
    {
        direction = "n";
    }
    else if (deg >= 33.75 && deg < 78.75)
    {
        direction = "ne";
    }
    else if (deg >= 78.75 && deg < 123.75)
    {
        direction = "e";
    }
    else if (deg >= 123.75 && deg < 168.75)
    {
        direction = "se";
    }
    else if (deg >= 168.75 && deg < 213.75)
    {
        direction = "s";
    }
    else if (deg >= 213.75 && deg < 258.75)
    {
        direction = "sw";
    }
    else if (deg >= 258.75 && deg < 303.75)
    {
        direction = "w";
    }
    else
    {
        direction = "nw";
    };
    <img class="wind_direction_img" src="@VirtualPathUtility.ToAbsolute("~/Images/" + direction + ".png")" />
}

@helper Day(WeatherForecast.Models.List day)
{
    DateTime date = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);
    date = date.AddSeconds(day.dt).ToLocalTime();
    <div class="row day panel panel-default">
        <div class="main col-md-1">
            <p class="day_of_week">@date.DayOfWeek</p>
            <p class="day_of_month">@date.Day</p>
            <p class="month">@date.ToString("MMMM", new CultureInfo("en-US"))</p>
        </div>
        <div class="day_info col-md-3">
            <div class="col-sm-5">
                <img src="@VirtualPathUtility.ToAbsolute("~/Images/Icons/" + day.weather.First().icon + ".png")" />
                <div class="temperature_min_max">@Temperature(day.temp.min) °C ~ @Temperature(day.temp.max) °C</div>
            </div>
            <div class="col-sm-7">
                <table class="table_info">
                    <tr>
                        <td style="width: 20px;"><img class="pressure_img" src="@VirtualPathUtility.ToAbsolute("~/Images/pressure.png")" /></td>
                        <td>@Math.Round(day.pressure) mm</td>
                    </tr>
                    <tr>
                        <td><img class="humidity_img" src="@VirtualPathUtility.ToAbsolute("~/Images/humidity.png")" /></td>
                        <td>@day.humidity %</td>
                    </tr>
                    <tr>
                        <td><img class="cloudiness_img" src="@VirtualPathUtility.ToAbsolute("~/Images/cloudiness.png")"/></td>
                        <td>@day.clouds %</td>
                    </tr>
                    <tr>
                        <td>@WindDirection(day.deg)</td>
                        <td>@Math.Round(day.speed, 1) m/sec</td>
                    </tr>
                </table>
            </div>
        </div>
        @TemperatureDuringDay(day.temp)
    </div>
}